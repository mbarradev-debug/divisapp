# Version 1.5.0

**Release Date**: January 2026

## Summary

Version 1.5.0 introduces the Authentication & Settings infrastructure (EPIC E). This release adds user settings management, a settings page, and the foundational structure for future authentication features. All authentication functionality is disabled by default via feature flags, ensuring the app continues to work fully as an anonymous, local-first application.

## Features Available in This Version

### Core Features (from previous versions)

- View all Chilean economic indicators with current values
- Favorite indicators with dedicated section at the top of home page
- Drag and drop reordering for favorites
- Indicator detail pages with historical charts and analytics
- 7/30/90 day range selection for historical data
- Currency conversion with real-time calculation
- Smart conversion defaults based on context
- Recent indicators section showing recently viewed items
- Notification settings UI with local persistence

### New in v1.5.0

#### Settings Page

A new settings page (`/settings`) allows users to manage their preferences:

- **Theme preference**: System (default), Light, or Dark
- **Default indicator**: Choose which indicator is used as default in conversions
- **Home ordering mode**: Default, Favorites-first, or Custom ordering
- **Alerts toggle**: Enable or disable alerts (for future notification features)
- **Reset local data**: Clear all favorites, preferences, and conversion history

#### User Settings Persistence

User preferences are now stored in localStorage with:

- Versioned schema for future migration support
- Type-safe validation on load
- Default values that match current app behavior

#### User State Indicator

The header now includes a user state indicator showing:

- Current account status (anonymous or preview mode)
- Quick navigation to the settings page
- Visual distinction for authenticated state (for development preview)

#### Authentication Infrastructure (Scaffold)

Structural foundation for future authentication:

- `AUTH_ENABLED` feature flag (defaults to `false`)
- Provider-agnostic `User` and `UserSettings` domain models
- Auth types compatible with future Auth.js integration
- Preview mode toggle for testing authenticated UX flows

#### Domain Models

New domain layer (`lib/domain/`) with:

- `User` type: Supports anonymous and authenticated users
- `UserSettings` type: Versioned settings with migration support
- Factory functions for creating default instances

## What Is Intentionally Not Included

These features were considered but are explicitly deferred:

- **Real authentication**: No OAuth, email/password, or social login
- **Backend sync**: All data remains local-only
- **Cloud storage**: No server-side persistence of favorites or settings
- **Theme toggle in header**: Theme follows system preference only
- **Multi-device sync**: Settings do not sync across devices

## Stability Notes

This version is stable and production-ready. The authentication scaffold:

- Has zero runtime impact when `AUTH_ENABLED=false` (default)
- Does not affect existing functionality
- Can be safely ignored until authentication is needed

Known limitations:

- Settings changes require page interaction (no live preview for some settings)
- Reset action requires page reload to ensure clean state

## Technical Changes

### Files Added

| File | Purpose |
|------|---------|
| `lib/domain/index.ts` | Domain model barrel exports |
| `lib/domain/user.ts` | User type and factory function |
| `lib/domain/user-settings.ts` | UserSettings type, defaults, and factory |
| `lib/feature-flags.ts` | Centralized feature toggles |
| `lib/auth/index.ts` | Auth module barrel exports |
| `lib/auth/types.ts` | Auth types for future integration |
| `app/settings/page.tsx` | Settings page (Server Component) |
| `app/settings/settings-client.tsx` | Settings form (Client Component) |
| `components/navigation/user-state-indicator.tsx` | Header user status |

### Files Modified

| File | Change |
|------|--------|
| `lib/storage.ts` | Added `useUserSettings()` and `useAuthState()` hooks |
| `lib/__tests__/storage.test.ts` | Added tests for user settings validation and migration |
| `app/layout.tsx` | Added UserStateIndicator to header |

### New Storage Keys

| Key | Content |
|-----|---------|
| `divisapp_user_settings` | User preferences (theme, defaultIndicator, etc.) |
| `divisapp_auth_preview` | Mock authentication state for development |

### API Changes

New hooks in `lib/storage.ts`:

```typescript
// User settings management
interface UseUserSettingsReturn {
  settings: UserSettings;
  updateSettings: (updates: Partial<Omit<UserSettings, 'version'>>) => void;
  resetSettings: () => void;
}

const { settings, updateSettings, resetSettings } = useUserSettings();

// Auth state (preview mode only)
interface UseAuthStateReturn {
  isAuthenticated: boolean;
  user: User;
  toggleAuthPreview: () => void;
}

const { isAuthenticated, user, toggleAuthPreview } = useAuthState();
```

New domain types in `lib/domain/`:

```typescript
// User model
interface User {
  readonly id: UserId;
  readonly isAnonymous: boolean;
  readonly createdAt: string;
}

// Settings model
interface UserSettings {
  readonly version: number;
  readonly userId?: UserId;
  readonly theme: ThemePreference;
  readonly defaultIndicator: IndicatorCode;
  readonly homeOrderingMode: HomeOrderingMode;
  readonly alertsEnabled: boolean;
}
```

Feature flag in `lib/feature-flags.ts`:

```typescript
// Enable via NEXT_PUBLIC_AUTH_ENABLED=true in environment
export const AUTH_ENABLED = process.env.NEXT_PUBLIC_AUTH_ENABLED === 'true';
```

## Changelog

### Added

- Settings page with user preferences management
- User settings persistence with versioned schema
- User state indicator in header navigation
- Domain models for User and UserSettings
- Feature flags infrastructure for gradual rollout
- Authentication scaffold (disabled by default)
- Preview mode for testing authenticated UX
- Reset functionality to clear all local data

### Changed

- Header navigation now includes user state indicator
- Storage module expanded with settings and auth hooks

### Technical Debt Addressed

- Centralized storage keys in constants
- Added validation for stored settings data
- Implemented migration path for future schema changes

## Upgrade Notes

No breaking changes. Existing favorites and conversion state are preserved.

New localStorage keys will be created on first use:

- `divisapp_user_settings`: Initialized with default values
- `divisapp_auth_preview`: Initialized as anonymous user

To enable authentication features in development:

```bash
# .env.local
NEXT_PUBLIC_AUTH_ENABLED=true
```

## Previous Versions

- [v1.4.0](v1.4.0.md) - Drag and drop reordering
- [v1.1.0](v1.1.0.md) - Favorites, charts, analytics
- [v1.0.0](v1.0.0.md) - Initial release
